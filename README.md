# ğŸ¬ Ticket-Booking System

A high-performance backend for ticket booking applications, inspired by platforms like BookMyShow. Designed to handle 50K+ concurrent users with robust concurrency control and scalability.

---

## ğŸ“‹ Table of Contents

- [Features](#-features)
- [Architecture](#-architecture)
- [Technology Stack](#-technology-stack)
- [Getting Started](#-getting-started)
- [Docker Compose](#-docker-compose)
- [API Endpoints](#-api-endpoints)
- [Project Structure](#-project-structure)
- [Database Schema](#-database-schema)
- [Testing](#-testing)
- [Scaling](#-scaling)
- [License](#-license)

---

## âœ¨ Features

- Users browse movies
- Select theater + showtime
- Pick seats
- Seat lock for few minutes
- Payment
- Booking confirmation
- Prevent double booking
- Handle 50K+ concurrent users

---

## Services

| Service              | Responsibility    |
| -------------------- | ----------------- |
| User Service         | Auth, profiles    |
| Movie Service        | Movies, metadata  |
| Show Service         | Showtimes         |
| Booking Service      | Reserve + confirm |
| Payment Service      | Payments          |
| Notification Service | SMS/email         |

---

## ğŸš€ System Design Technologies

### ğŸ— Backend Architecture

| Technology | Description |
|------------|-------------|
| **Golang (Go)** | High-performance backend service with native concurrency support |
| **RESTful API** | API layer for booking operations using Gin web framework |
| **Layered Architecture** | Clean separation between Controllers, Services, and Repository layers |

---

### ğŸ”€ CQRS Pattern

> **Command Query Responsibility Segregation**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    CQRS ARCHITECTURE                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      COMMANDS             â”‚      EVENT STORE            â”‚           QUERIES                        â”‚
â”‚   (Write Side)            â”‚                             â”‚         (Read Side)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚                             â”‚                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚ Seat        â”‚         â”‚   â”‚  events table   â”‚       â”‚   â”‚ Fetch Shows â”‚                        â”‚
â”‚   â”‚ Reservation â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚       â”‚   â”‚             â”‚                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚ â€¢ aggregate_id  â”‚       â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚           â”‚               â”‚   â”‚ â€¢ event_type   â”‚       â”‚          â”‚                               â”‚
â”‚           â–¼               â”‚   â”‚ â€¢ payload      â”‚       â”‚          â–¼                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚ â€¢ created_at   â”‚       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚  Payment    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚       â”‚   â”‚   Seat      â”‚                        â”‚
â”‚   â”‚  Processing â”‚         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚Availability â”‚                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚            â”‚                 â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚           â”‚               â”‚            â”‚                 â”‚          â”‚                               â”‚
â”‚           â–¼               â”‚            â–¼                 â”‚          â–¼                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚ Reservation â”‚         â”‚   â”‚ Projection      â”‚       â”‚   â”‚    User     â”‚                        â”‚
â”‚   â”‚ Confirmationâ”‚         â”‚   â”‚ Worker          â”‚       â”‚   â”‚  Bookings   â”‚                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                           â”‚            â”‚                 â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚            â”‚                 â”‚
                            â”‚            â–¼                 â”‚
                            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                            â”‚   â”‚ Reservation     â”‚       â”‚
                            â”‚   â”‚ Projection      â”‚       â”‚
                            â”‚   â”‚                 â”‚       â”‚
                            â”‚   â”‚ â€¢ TicketReservedâ”‚       â”‚
                            â”‚   â”‚ â€¢ TicketCancel  â”‚       â”‚
                            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                            â”‚            â”‚                 â”‚
                            â”‚            â–¼                 â”‚
                            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                            â”‚   â”‚   Read Model    â”‚       â”‚
                            â”‚   â”‚ (reservations)  â”‚       â”‚
                            â”‚   â”‚                 â”‚       â”‚
                            â”‚   â”‚ â€¢ seat_id       â”‚       â”‚
                            â”‚   â”‚ â€¢ user_id       â”‚       â”‚
                            â”‚   â”‚ â€¢ status        â”‚       â”‚
                            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                            â”‚                             â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CQRS Flow:**

1. **Commands (Write Side)**: User actions like seat reservation, payment processing are handled as commands
2. **Event Store**: Commands are stored as events in the `events` table (event sourcing)
3. **Projection Worker**: `ReservationProjection` reads events from the event store and updates the read model
4. **Read Model**: The `reservations` table is updated with the latest booking status
5. **Queries (Read Side)**: Read operations like fetching shows, checking seat availability, and retrieving user bookings query the optimized read model

- **Command Side** (`/cmd/*`): Handles seat booking, payment, reservation updates â†’ writes to Event Store
- **Query Side** (`/query/*`): Optimized for fetching shows, seat availability, user bookings â†’ reads from Read Model
- **Benefits**: Improves performance under heavy concurrent traffic, separates read/write concerns

---

### CQRS Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                CQRS DATA FLOW                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚    â”‚      COMMAND API     â”‚                                    â”‚      QUERY API      â”‚                                    â”‚
â”‚    â”‚  (Reserve/Cancel)    â”‚                                    â”‚   (Availability)    â”‚                                    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚               â”‚                                                        â”‚                                                â”‚
â”‚               â”‚  Write DB (Postgres)                                  â”‚  Read DB (Postgres Replica)                   â”‚
â”‚               â–¼                                                        â–¼                                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚    â”‚    Primary DB        â”‚                                    â”‚   Read Replica      â”‚                                    â”‚
â”‚    â”‚  (Write Operations) â”‚                                    â”‚  (Read Operations)  â”‚                                    â”‚
â”‚    â”‚  â€¢ Reservations     â”‚                                    â”‚  â€¢ Shows            â”‚                                    â”‚
â”‚    â”‚  â€¢ Payments         â”‚                                    â”‚  â€¢ Seat Availabilityâ”‚                                    â”‚
â”‚    â”‚  â€¢ Users            â”‚                                    â”‚  â€¢ User Bookings    â”‚                                    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚               â”‚                                                                                                            â”‚
â”‚               â”‚                                                                                                            â”‚
â”‚               â–¼                                                                                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚                                         KAFKA TOPIC: booking.events                                                â”‚    â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚    â”‚                                                                                                                                  â”‚
â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚    â”‚
â”‚    â”‚   â”‚ ReservationCreatedâ”‚    â”‚  SeatLocked      â”‚    â”‚BookingConfirmed  â”‚    â”‚  SeatReleased    â”‚                   â”‚    â”‚
â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚    â”‚
â”‚    â”‚            â”‚                      â”‚                      â”‚                      â”‚                             â”‚    â”‚
â”‚    â”‚            â–¼                      â–¼                      â–¼                      â–¼                             â”‚    â”‚
â”‚    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚    â”‚   â”‚                                    EVENT STORE                                                      â”‚   â”‚    â”‚
â”‚    â”‚   â”‚   â€¢ aggregate_id    â€¢ event_type    â€¢ payload (JSON)    â€¢ created_at                              â”‚   â”‚    â”‚
â”‚    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚    â”‚                                                                                                            â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚               â”‚                                                                                                            â”‚
â”‚               â”‚                                                                                                            â”‚
â”‚               â–¼                                                                                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                â”‚
â”‚    â”‚  PROJECTION WORKER   â”‚                                                                                                â”‚
â”‚    â”‚    (Consumer)        â”‚                                                                                                â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                                                                â”‚
â”‚    â”‚  â€¢ Reads events      â”‚                                                                                                â”‚
â”‚    â”‚  â€¢ Updates read modelâ”‚                                                                                                â”‚
â”‚    â”‚  â€¢ Transforms data   â”‚                                                                                                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                â”‚
â”‚               â”‚                                                                                                            â”‚
â”‚               â”‚  Updates Read DB                                                                                           â”‚
â”‚               â–¼                                                                                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                â”‚
â”‚    â”‚      READ DB         â”‚                                                                                                â”‚
â”‚    â”‚  (Projections)       â”‚                                                                                                â”‚
â”‚    â”‚  â€¢ seat_availability â”‚                                                                                                â”‚
â”‚    â”‚  â€¢ user_bookings     â”‚                                                                                                â”‚
â”‚    â”‚  â€¢ show_stats        â”‚                                                                                                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                â”‚
â”‚                                                                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Data Flow:**
1. **Command API** handles Reserve/Cancel operations â†’ writes to Primary DB (Postgres)
2. **Query API** handles Availability queries â†’ reads from Read Replica (Postgres)
3. **Events** are published to Kafka Topic: `booking.events`
4. **Projection Worker** consumes events from Kafka and updates the Read DB
5. **Read DB** stores projections for optimized query performance

---

### ğŸ—„ Database & Storage

| Feature | Implementation |
|---------|----------------|
| **PostgreSQL 15** | Relational DB for shows, seats, bookings (Command & Query databases) |
| **ACID Transactions** | Ensures safe booking without double reservation |
| **Database Indexing** | Faster show/search queries |
| **GORM** | ORM for database operations |

---

### ğŸ”’ Concurrency & Seat Locking

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SEAT LOCKING MECHANISM                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   User A              User B              User C             â”‚
â”‚     â”‚                   â”‚                   â”‚                â”‚
â”‚     â–¼                   â–¼                   â–¼                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ â”‚ Lock    â”‚        â”‚ Lock    â”‚        â”‚ Lock    â”‚           â”‚
â”‚ â”‚ Seat 5  â”‚        â”‚ Seat 5  â”‚        â”‚ Seat 6  â”‚           â”‚
â”‚ â”‚ (10 min)â”‚        â”‚ (FAIL!) â”‚        â”‚ (OK!)   â”‚           â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚     â”‚                                      â”‚                â”‚
â”‚     â–¼                                      â–¼                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚ Book/   â”‚                          â”‚ Book/   â”‚            â”‚
â”‚ â”‚ Release â”‚                          â”‚ Release â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **Seat Locking**: Prevents double booking with configurable timeout (10 minutes)
- **Optimistic Locking**: Version-based conflict detection
- **Pessimistic Locking**: Database-level row locking
- **Go Concurrency**: Goroutines & Mutex Locks for thread-safe operations
- **Distributed Locking**: Redis-based distributed locks for 50K+ concurrent users

---

### âš¡ Caching Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REDIS CACHE LAYER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Seat Locks     â”‚    â”‚  Show Cache    â”‚                â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                â”‚
â”‚  â”‚  seat:5:user:1  â”‚    â”‚  show:123       â”‚                â”‚
â”‚  â”‚  TTL: 10 min    â”‚    â”‚  TTL: 5 min     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Rate Limiting  â”‚    â”‚  Session Cache  â”‚                â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                â”‚
â”‚  â”‚  ip:192.168.1.1 â”‚    â”‚  jwt:token123   â”‚                â”‚
â”‚  â”‚  count: 100/min â”‚    â”‚  TTL: 24 hrs    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **Redis** for real-time seat availability and temporary locks

- **Real-time seat availability**
- **Temporary seat locks** (TTL: 10 minutes)
- **Session management**
- **Rate limiting** (5000 requests/minute)
- **Job Queue**: Redis-based job queue for background processing
- Reduces database load significantly

---

### ğŸ“© Job Queues & Background Processing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   JOB QUEUE SYSTEM                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚    API Server              Worker              External      â”‚
â”‚       â”‚                     â”‚                    â”‚          â”‚
â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                    â”‚          â”‚
â”‚       â”œâ”€â”€â–ºâ”‚ Enqueue  â”‚â”€â”€â”€â”€â”€â”€â”¤                    â”‚          â”‚
â”‚       â”‚  â”‚  Job     â”‚       â”‚                    â”‚          â”‚
â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                    â”‚          â”‚
â”‚       â”‚                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
â”‚       â”‚                     â”œâ”€â”€â–ºâ”‚ Process Job  â”‚   â”‚          â”‚
â”‚       â”‚                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
â”‚       â”‚                     â”‚         â”‚            â”‚          â”‚
â”‚       â”‚                     â”‚         â–¼            â–¼          â”‚
â”‚       â”‚                     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚       â”‚                     â”‚   â”‚ â€¢ Email/SMS        â”‚      â”‚
â”‚       â”‚                     â”‚   â”‚ â€¢ Payment Verify   â”‚      â”‚
â”‚       â”‚                     â”‚   â”‚ â€¢ Expiry Cleanup   â”‚      â”‚
â”‚       â”‚                     â”‚   â”‚ â€¢ Analytics        â”‚      â”‚
â”‚       â”‚                     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚                     â”‚                                 â”‚
â”‚       â–¼                     â–¼                                 â”‚
â”‚   (Response)          (Background)                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Async Operations:**
- âœ… Booking confirmation emails/SMS
- âœ… Payment verification
- âœ… Reservation expiry cleanup
- âœ… Analytics logging
- âœ… Event dispatching via Kafka

---

### ğŸ“¡ Event-Driven System Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EVENT-DRIVEN FLOW                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Reservation â”‚â”€â”€â”€â–ºâ”‚   SeatLock   â”‚â”€â”€â”€â–ºâ”‚    Payment   â”‚ â”‚
â”‚  â”‚   Created    â”‚    â”‚    Event     â”‚    â”‚   Verified   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                   â”‚                   â”‚            â”‚
â”‚         â–¼                   â–¼                   â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   EVENT STORE                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚
â”‚  â”‚  â”‚Event #1 â”‚ â”‚Event #2 â”‚ â”‚Event #3 â”‚ â”‚Event #4 â”‚ ...  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                   â”‚                   â”‚            â”‚
â”‚         â–¼                   â–¼                   â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Booking    â”‚    â”‚    User      â”‚    â”‚   Payment    â”‚ â”‚
â”‚  â”‚  Confirmed   â”‚    â”‚  Notificationâ”‚    â”‚    Record    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Events:**
- `TicketReserved` - Initial seat reservation
- `SeatLocked` - Seat temporarily locked
- `TicketConfirmed` - Payment successful
- `TicketCancelled` - Lock expired or cancelled
- `PaymentVerified` - Payment verification completed
- `UserRegistered` - New user registration

---

### ğŸ” Authentication & Security

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATION FLOW                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   Client                                                    â”‚
â”‚     â”‚                                                       â”‚
â”‚     â”‚ 1. Login (email/password)                             â”‚
â”‚     â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚   Generate JWT      â”‚                                   â”‚
â”‚   â”‚   Token             â”‚                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚     â”‚                                                       â”‚
â”‚     â”‚ 2. Bearer Token                                       â”‚
â”‚     â–¼                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚   Auth Middleware   â”‚â”€â”€â”€â–ºâ”‚   Verify Token      â”‚       â”‚
â”‚   â”‚   (Gin)             â”‚    â”‚   Extract User ID   â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚     â”‚                               â”‚                        â”‚
â”‚     â”‚ 3. Request + User Context     â”‚                        â”‚
â”‚     â–¼                               â–¼                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚   Admin?            â”‚    â”‚   Regular User?    â”‚       â”‚
â”‚   â”‚   Full Access       â”‚    â”‚   Limited Access   â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Feature | Implementation |
|---------|----------------|
| **JWT Authentication** | Secure session handling with token-based auth |
| **Role-Based Access Control (RBAC)** | Admin & User roles |
| **Rate Limiting** | Prevent API abuse (5000 req/min) |
| **Structured Logging** | Debugging & tracing |

---

### ğŸ“Š Scalability Concepts

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         LOAD BALANCER               â”‚
                    â”‚        (nginx/haproxy)              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                       â”‚                       â”‚
           â–¼                       â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   API Pod 1 â”‚        â”‚   API Pod 2 â”‚        â”‚   API Pod N â”‚
    â”‚  (Go)       â”‚        â”‚  (Go)       â”‚        â”‚  (Go)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚                       â”‚                       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      SHARED INFRASTRUCTURE  â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚  â€¢ PostgreSQL (Primary)     â”‚
                    â”‚  â€¢ Redis Cluster           â”‚
                    â”‚  â€¢ Message Queue           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **Horizontal Scaling**: Supports multiple backend instances
- **Load Balancing**: Handles high traffic during peak booking times
- **Microservice-Friendly**: Booking, Payment, Movies can be separated

---

### ğŸ³ DevOps & Deployment

| Tool | Purpose |
|------|---------|
| **Docker** | Containerized backend |
| **Docker Compose** | Multi-service setup (DB + Redis + API + Kafka) |
| **Kubernetes** | Production deployment with HPA |
| **Nginx** | Load balancer |

---

### ğŸ“ˆ Monitoring & Logging

| Feature | Status |
|---------|--------|
| **Structured Logging** | âœ… Implemented |
| **Request Logging** | âœ… Implemented |
| **Error Tracing** | âœ… Implemented |
| **Prometheus + Grafana** | ğŸ”œ Future Scope |

---

### ğŸ§ª Testing & Reliability

| Type | Description |
|------|-------------|
| **Unit Testing** | Go testing package |
| **Integration Testing** | Booking workflow tests |
| **API Testing** | Postman collection ready |

---

## ğŸ›  Technology Stack

| Category          | Technology                    |
| ----------------- | ----------------------------- |
| Language          | Go 1.21+                     |
| Framework         | Gin                           |
| Database          | PostgreSQL 15                 |
| Cache             | Redis 7                       |
| ORM               | GORM                          |
| Authentication    | JWT                           |
| Message Queue     | Kafka                         |
| Container         | Docker                        |
| Orchestration     | Kubernetes                    |

---

## ğŸš€ Getting Started

### Prerequisites

- **Go** 1.21 or higher
- **Docker** & Docker Compose
- **PostgreSQL** 15
- **Redis** 7

### Run Locally

```
bash
# Install dependencies
go mod download

# Run API server
go run cmd/api/main.go

# Run background worker (in separate terminal)
go run cmd/worker/main.go
```

### Environment Variables

Create a `.env` file in the root directory:

```
env
# Database
DB_USER=ticket
DB_PASSWORD=ticket123

# Server
PORT=8080

# Kafka
KAFKA_BROKER=localhost:9092
```

---

## ğŸ³ Docker Compose

### Services Overview

The Docker Compose setup includes the following services:

| Service | Container Name | Port | Description |
|---------|---------------|------|-------------|
| `postgres_cmd` | ticket-cmd-db | 5433 | Command Database (Write) |
| `postgres_query` | ticket-query-db | 5434 | Query Database (Read) |
| `redis` | ticket-booking-redis | 6379 | Cache & Queue |
| `zookeeper` | ticket-zookeeper | 2181 | Kafka Manager |
| `kafka` | ticket-kafka | 9092 | Message Broker |
| `api` | ticket-booking-api | 8081 | API Server |
| `worker` | ticket-booking-worker | - | Background Worker |

### Quick Start with Docker Compose

```
bash
# Clone the repository
git clone https://github.com/hitorii/ticket-booking.git
cd ticket-booking

# Create .env file
echo "DB_USER=ticket" > .env
echo "DB_PASSWORD=ticket123" >> .env

# Start all services
docker-compose up -d

# Access API
http://localhost:8081

# View logs
docker-compose logs -f

# Stop all services
docker-compose down
```

### Database Access

```
bash
# Connect to Command Database
docker exec -it ticket-cmd-db psql -U ticket -d ticket_cmd_db

# Connect to Query Database
docker exec -it ticket-query-db psql -U ticket -d ticket_query_db
```

---

## ğŸ“¡ API Endpoints

> **For complete API documentation with request/response examples, refer to [Postman Documentation](./docs/POSTMAN.md)**

### Base URL
```
http://localhost:8081
```

### Command Endpoints (Write Operations)

| Method | Endpoint | Description | Request Body |
|--------|----------|-------------|--------------|
| POST | `/cmd/reserve` | Reserve a ticket | `{"user_id": "1", "seat_id": "A1"}` |
| POST | `/cmd/confirm` | Confirm ticket booking | `{"user_id": "1", "seat_id": "A1"}` |
| POST | `/cmd/cancel` | Cancel ticket reservation | `{"user_id": "1", "seat_id": "A1"}` |
| POST | `/cmd/users/register` | Register new user | `{"username": "john", "email": "john@example.com", "password": "pass123", "is_admin": false}` |
| POST | `/cmd/movies` | Create new movie | `{"name": "Inception", "genre": "Sci-Fi", "duration": 148}` |
| POST | `/cmd/shows` | Create new show | `{"movie_id": 1, "theater": "Theater A", "start_time": "2024-01-20T14:00:00Z"}` |
| POST | `/cmd/payments/initiate` | Initiate payment | `{"booking_id": "1", "user_id": "1", "amount": 500}` |
| POST | `/cmd/payments/verify` | Verify payment | `{"payment_id": "pay_xxx", "mode": "success"}` |

### Query Endpoints (Read Operations)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/query/movies` | List all movies |
| GET | `/query/movies/:id` | Get movie by ID |
| GET | `/query/shows` | List all shows |
| GET | `/query/availability/:seat_id` | Check seat availability |
| GET | `/query/reservations/:user_id` | Get user reservations |
| GET | `/query/users` | List all users |
| GET | `/query/events` | Get all events |
| GET | `/query/notifications/:user_id` | Get user notifications |

### System Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/health` | Health check |

---

## ğŸ“ Project Structure

```
.
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .prettierignore
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ docker-compose.scaling.yml
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ main.go              # API server entry point
â”‚   â””â”€â”€ worker/
â”‚       â””â”€â”€ main.go              # Background worker entry point
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile.api           # API container image
â”‚   â”œâ”€â”€ Dockerfile.worker       # Worker container image
â”‚   â””â”€â”€ nginx.conf               # Nginx load balancer config
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ booking/
â”‚   â”‚   â”œâ”€â”€ command_handler.go   # Booking command handlers
â”‚   â”‚   â”œâ”€â”€ command_service.go  # Booking business logic
â”‚   â”‚   â”œâ”€â”€ projection.go        # Event projection
â”‚   â”‚   â”œâ”€â”€ query_handler.go     # Booking query handlers
â”‚   â”‚   â””â”€â”€ query_service.go    # Booking query service
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go            # Configuration
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ command.go           # Command database connection
â”‚   â”‚   â””â”€â”€ query.go            # Query database connection
â”‚   â”œâ”€â”€ events/
â”‚   â”‚   â”œâ”€â”€ dispatcher.go       # Event dispatcher
â”‚   â”‚   â”œâ”€â”€ store.go            # Event store
â”‚   â”‚   â””â”€â”€ types.go            # Event types
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.go             # Authentication middleware
â”‚   â”‚   â”œâ”€â”€ logger.go           # Logging middleware
â”‚   â”‚   â””â”€â”€ rateLimiter.go      # Rate limiting middleware
â”‚   â”œâ”€â”€ movie/
â”‚   â”‚   â”œâ”€â”€ command_handler.go  # Movie command handlers
â”‚   â”‚   â”œâ”€â”€ command_service.go  # Movie business logic
â”‚   â”‚   â”œâ”€â”€ model.go            # Movie model
â”‚   â”‚   â”œâ”€â”€ query_handler.go    # Movie query handlers
â”‚   â”‚   â””â”€â”€ query_service.go    # Movie query service
â”‚   â”œâ”€â”€ notification/
â”‚   â”‚   â”œâ”€â”€ command_handler.go
â”‚   â”‚   â”œâ”€â”€ command_service.go
â”‚   â”‚   â”œâ”€â”€ model.go
â”‚   â”‚   â”œâ”€â”€ query_handler.go
â”‚   â”‚   â”œâ”€â”€ query_service.go
â”‚   â”‚   â”œâ”€â”€ queue.go
â”‚   â”‚   â”œâ”€â”€ repository.go
â”‚   â”‚   â””â”€â”€ worker.go
â”‚   â”œâ”€â”€ payments/
â”‚   â”‚   â”œâ”€â”€ command_handler.go  # Payment command handlers
â”‚   â”‚   â”œâ”€â”€ command_service.go  # Payment business logic
â”‚   â”‚   â”œâ”€â”€ model.go            # Payment model
â”‚   â”‚   â”œâ”€â”€ query_handler.go    # Payment query handlers
â”‚   â”‚   â”œâ”€â”€ query_service.go    # Payment query service
â”‚   â”‚   â””â”€â”€ repository.go       # Payment repository
â”‚   â”œâ”€â”€ queue/
â”‚   â”‚   â”œâ”€â”€ jobs.go             # Job definitions
â”‚   â”‚   â”œâ”€â”€ redis.go            # Redis queue
â”‚   â”‚   â””â”€â”€ stream.go           # Stream processing
â”‚   â”œâ”€â”€ show/
â”‚   â”‚   â”œâ”€â”€ command_handler.go  # Show command handlers
â”‚   â”‚   â”œâ”€â”€ command_service.go  # Show business logic
â”‚   â”‚   â”œâ”€â”€ model.go            # Show model
â”‚   â”‚   â”œâ”€â”€ query_handler.go    # Show query handlers
â”‚   â”‚   â””â”€â”€ query_service.go    # Show query service
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ command_handler.go  # User command handlers
â”‚   â”‚   â”œâ”€â”€ command_service.go  # User business logic
â”‚   â”‚   â”œâ”€â”€ model.go            # User model
â”‚   â”‚   â”œâ”€â”€ query_handler.go    # User query handlers
â”‚   â”‚   â””â”€â”€ query_service.go    # User query service
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ cache.go            # Cache utilities
â”‚       â”œâ”€â”€ lock.go             # Distributed lock
â”‚       â””â”€â”€ response.go         # Response helpers
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ Command-DB/
â”‚   â”‚   â”œâ”€â”€ 001_event.sql
â”‚   â”‚   â”œâ”€â”€ 002_reservation.sql
â”‚   â”‚   â”œâ”€â”€ 003_user.sql
â”‚   â”‚   â”œâ”€â”€ 004_movies.sql
â”‚   â”‚   â”œâ”€â”€ 005_shows.sql
â”‚   â”‚   â”œâ”€â”€ 006_payments.sql
â”‚   â”‚   â””â”€â”€ 007_notifications.sql
â”‚   â””â”€â”€ Query-DB/
â”‚       â”œâ”€â”€ 001_project.sql
â”‚       â”œâ”€â”€ 002_reservation.sql
â”‚       â”œâ”€â”€ 003_shows&movies.sql
â”‚       â”œâ”€â”€ 004_payment.sql
â”‚       â”œâ”€â”€ 005_notification.sql
â”‚       â””â”€â”€ 006_user.sql
â”œâ”€â”€ k8s/
â”‚   â”œâ”€â”€ api-deployment.yaml
â”‚   â”œâ”€â”€ hpa.yaml
â”‚   â”œâ”€â”€ ingress.yaml
â”‚   â””â”€â”€ namespace.yaml
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ POSTMAN.md
â”‚   â”œâ”€â”€ SCALING.md
â”‚   â”œâ”€â”€ postman-collection.json
â”‚   â””â”€â”€ README.md
â””â”€â”€ postgres-data/
```

---

## ğŸ—„ Database Schema

### Command Database (Write)

```
sql
-- Events table for event sourcing
CREATE TABLE events (
    id BIGSERIAL PRIMARY KEY,
    aggregate_id UUID NOT NULL,
    event_type VARCHAR(100) NOT NULL,
    payload JSONB NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_events_aggregate ON events(aggregate_id);
CREATE INDEX idx_events_type ON events(event_type);
```

### Query Database (Read)

Optimized for fast queries:
- `reservations` - User bookings
- `shows` & `movies` - Showtime data
- `payments` - Payment records
- `notifications` - User alerts

---

## ğŸ§ª Testing

### Using Postman

1. Import `docs/postman-collection.json` into Postman
2. Set the base URL to `http://localhost:8081`
3. Follow the testing workflow in [Postman Documentation](./docs/POSTMAN.md)

### Example Workflow

```
bash
# 1. Register a new user
POST /cmd/users/register
{"username": "john", "email": "john@example.com", "password": "pass123", "is_admin": false}

# 2. List movies
GET /query/movies

# 3. Create a show (admin)
POST /cmd/shows
{"movie_id": 1, "theater": "Theater A", "start_time": "2024-01-20T14:00:00Z"}

# 4. Check seat availability
GET /query/availability/A1

# 5. Reserve a ticket
POST /cmd/reserve
{"user_id": "1", "seat_id": "A1"}

# 6. Confirm the booking
POST /cmd/confirm
{"user_id": "1", "seat_id": "A1"}

# 7. Initiate payment
POST /cmd/payments/initiate
{"booking_id": "1", "user_id": "1", "amount": 500}

# 8. Verify payment
POST /cmd/payments/verify
{"payment_id": "pay_xxx", "mode": "success"}

# 9. Check user reservations
GET /query/reservations/1

# 10. Check notifications
GET /query/notifications/1
```

---

## ğŸ“ˆ Scaling

The system supports horizontal scaling with:

- **Load Balancing**: Nginx
- **Auto-scaling**: Kubernetes HPA
- **Session Management**: Redis
- **Rate Limiting**: Per-IP token bucket (5000 req/min)
- **Distributed Locking**: Redis-based locks for concurrency control

For detailed scaling documentation, see [SCALING.md](./docs/SCALING.md).

---

## ğŸ“„ License

MIT License - Feel free to use this project for learning and development.

---

<div align="center">

**Built with â¤ï¸ using Go + PostgreSQL + Redis**

</div>
